<script>
import CommandPalette from './command-palette';
import {Data, Store} from '../data';

export default {
	store: () => Store,
	oncreate () {
		this.palette = new CommandPalette({
			searchInFields: ['title', 'text'],
			dataSrc: this.getNotes.bind(this),
			sizeContainer: 'body',
			itemRenderer: ({title, text, highlighted}) => {
				if (highlighted) {
					if (highlighted.title) title = highlighted.title;
					if (highlighted.text) text = highlighted.text;
				}
				return `<div class="item-name">${title}</div>
					<span class="item-sub">${text}</span>`;
			}
		});

		this.palette.on('action', this.onNoteSelect.bind(this));


		document.addEventListener('keydown', this.onkeydown.bind(this));
	},
	methods: {
		getNotes () {
			return this.store.get().notes;
		},

		onNoteSelect (note) {
			this.store.set({ note });
		},

		onkeydown (ev) {
			if (this.palette.state.open) return;

			const key = ev.key;
			const {note} = this.store.get();

			if (note && key === 'e') this.action('start-edit');
		},

		action (action) {
			this.fire('action', {action});
		}

	}
};
</script>
