<div class="list folders">
	<div class="scroller" ref:list>
		{#each folders as folder}
			<div
				tabindex="0"
				class="list-item folder {folder === $folder ? 'selected' : ''}"
				on:focus="open(folder)"
				on:click="onclick(event, folder)"
				on:dragover="ondragenter(event)"
				on:dragenter="ondragenter(event)"
				on:dragleave="ondragleave(event)"
				on:drop="ondrop(event, folder)"
				>{folder || 'All Notes'}</div>
		{/each}
	</div>
</div>

<script>
import {Data, Store} from '../data';
export default {
	store: () => Store,
	computed: {
		folders ({$notes}) {
			let folders = $notes.map(n => n.folder).filter(n => !!n);
			folders = [...new Set(folders)];
			folders.sort((a, b) => a.localeCompare(b));
			folders.unshift('');
			return folders;
		}
	},
	methods: {
		open (folder) {
			if (this.store.get().mode === 'view') this.store.set({ folder, note: null });
			else document.querySelector('.note-title-input').select();
		},
		onclick (ev, folder) {
			ev.preventDefault();
			this.open(folder);
		},

		ondragenter (ev) {
			ev.preventDefault();
			ev.target.classList.add('drag-over');
		},

		ondragleave (ev) {
			ev.target.classList.remove('drag-over');
		},

		ondrop (ev, folder) {
			ev.preventDefault();
			ev.target.classList.remove('drag-over');

			const itemId = +ev.dataTransfer.getData('itemId');
			const notes = this.store.get().notes;
			const note = notes.find(note => note.id === itemId);
			note.folder = folder;

			Data.Notes.save(note).then(res => {
				this.store.set({ notes });
			});
		},

	}
};
</script>
