<div class="notes">
	{#if folder}
	<h2>
		<span>{folder.name || ''}</span>
		<button class="btn" on:click="add()">+</button>
	</h2>
	<div class="scroller">
		{#each notes as item}
		<a href="#{item.id}"
		class="note {isSelected(item, selected) ? 'selected' : ''}"
		on:click="select(item)">{item.title}</a>
		{/each}
	</div>
	{/if}
</div>


<script>
import Data from '../data';

export default {
	data () {
		return {
			isLoading: true,
			folder: null,
			selected: null,
			items: [],
		};
	},
	computed: {
		notes ({items}) {
			return items.sort((a, b) => a.title.localeCompare(b.title));
		}
	},
	helpers: {
		isSelected (item, selected) {
			if (!selected || !item) return false;
			return selected.id === item.id;
		}
	},

	methods: {
		load (folder) {
			if (!folder) return this.set({ items: [], isLoading: false, folder: null });
			if (!this.get().items.length) this.set({ isLoading: true });
			Data.Notes.get(folder.id).then(items => {
				this.set({ items, isLoading: false, folder });
			});
		},

		add () {
			const folder_id = this.get().folder.id;
			Data.Notes
				.save({ id: null, name: 'New note', folder_id })
				.then(item => {
						const items = this.get().items;
						items.unshift(item);
						this.set({ items });
						this.select(item);
					});
		},

		select (item) {
			this.set({ selected: item });
			this.fire('select', item);
		},

	}
};
</script>
