<div class="editor">
	{#if note}
	<form on:submit="save(event)">
		<h2>
			<input bind:value="note.title" ref:title>
			<div class="flex-filler"></div>
			<button type="submit" class="btn">Save</button>
			<button type="button" class="btn" on:click="del(note.id)">Delete</button>
			<button type="button" class="btn">&times;</button>
		</h2>
		<div class="scroller">
			<textarea bind:value="note.text"></textarea>
		</div>
	</form>
	{/if}
</div>


<script>
import Data from '../data';

export default {
	data () {
		return {
			isLoading: true,
			note: null,
		};
	},

	methods: {
		load (note) {
			if (!note) return this.set({ note: null, isLoading: false });
			if (!this.get().note) this.set({ isLoading: true });

			Data.Notes.getOne(note.id).then(res => {
				this.set({ note: res, isLoading: false });
				this.refs.title.select();
			});
		},

		save (e) {
			e.preventDefault();
			const note = this.get().note;
			Data.Notes.save(note).then(res => {
				this.fire('save', note);
			});
		},

		del (id) {
			Data.Notes.del(id).then(res => {
				this.set({ note: null });
				this.fire('note-delete');
			});
		}
	}
};
</script>
