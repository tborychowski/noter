<Header ref:header/>
<Folders ref:folders/>
<Notes ref:notes/>
<Editor ref:editor/>
<Palette ref:palette/>

<script>
import {Data, Store, EVENT} from '../data';
import {setUrl, getStateFromUrl} from '../util';

export default {
	components: {
		Header: '../header',
		Folders: '../folders',
		Notes: '../notes',
		Editor: '../editor',
		Palette: '../palette',
	},
	store: () => Store,
	oncreate () {
		this.store.on('state', ({ changed, current }) => setUrl(current));
		this.store.set(getStateFromUrl());
		this.load();
	},

	methods: {
		load () {
			Data.Notes.get().then(notes => {
				this.store.set({ notes });

				const selectedNote = this.store.get().note;
				if (selectedNote && selectedNote.id && !selectedNote.title) {
					const note = notes.find(n => n.id === selectedNote.id);
					this.store.set({ note });
					EVENT.fire(EVENT.focus.selectedNote);
				}
			});
		},


	}
};

</script>
