<Header ref:header/>
<Folders ref:folders/>
<Notes ref:notes/>
<Editor ref:editor/>
<Palette ref:palette/>

<script>
import {Data, Store} from '../data';
import {setUrl, getStateFromUrl} from '../util';

export default {
	components: {
		Header: '../header',
		Folders: '../folders',
		Notes: '../notes',
		Editor: '../editor',
		Palette: '../palette',
	},
	store: () => Store,
	oncreate () {
		this.store.on('state', ({ changed, current }) => setUrl(current));
		this.store.set(getStateFromUrl());

		this.refs.palette.on('action', ev => {
			if (ev.action === 'start-edit') this.refs.editor.edit();
			else if (ev.action === 'new-note') this.refs.header.newNote();
		});

		this.refs.header.on('action', ev => {
			if (ev.action === 'palette-show') this.refs.palette.show();
		});

		this.load();
	},

	methods: {
		load () {
			Data.Notes.get().then(notes => {
				this.store.set({ notes });

				const selectedNote = this.store.get().note;
				if (selectedNote && selectedNote.id && !selectedNote.title) {
					const note = notes.find(n => n.id === selectedNote.id);
					this.store.set({ note });
				}
			});
		},


	}
};

</script>
