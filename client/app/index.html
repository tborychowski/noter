<Header></Header>
<Folders ref:folders></Folders>
<Notes ref:notes></Notes>
<Editor ref:editor></Editor>

<script>
import Header from '../header';
import Folders from '../folders';
import Notes from '../notes';
import Editor from '../editor';
import {Store} from '../data';
import {setUrl} from '../util';
import {getStateFromUrl} from '../util';


export default {
	components: { Header, Folders, Notes, Editor },
	store: () => Store,
	oncreate () {
		this.refs.notes.on('folder-delete', this.onFolderDelete.bind(this));
		this.refs.editor.on('save', this.reloadNotes.bind(this));
		this.refs.editor.on('note-delete', this.reloadNotes.bind(this));

		this.store.on('state', ({ changed, current }) => setUrl(current));

		const state = getStateFromUrl();
		this.store.set(state);
	},

	methods: {
		onFolderDelete () {
			this.refs.folders.load();
			this.refs.notes.load();
		},
		reloadNotes () {
			this.refs.notes.load();
		},

	}
};

</script>
