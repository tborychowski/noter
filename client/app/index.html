<Header ref:header></Header>
<Folders ref:folders></Folders>
<Notes ref:notes></Notes>
<Editor ref:editor></Editor>

<script>
import Header from '../header';
import Folders from '../folders';
import Notes from '../notes';
import Editor from '../editor';
import {Data, Store} from '../data';
import {setUrl} from '../util';
import {getStateFromUrl} from '../util';


export default {
	components: { Header, Folders, Notes, Editor },
	store: () => Store,
	oncreate () {
		this.store.on('state', ({ changed, current }) => setUrl(current));
		this.store.set(getStateFromUrl());

		this.load();
	},

	methods: {
		load () {
			Data.Notes.get().then(notes => {
				this.store.set({ notes });

				const selectedNote = this.store.get().note;
				if (selectedNote && selectedNote.id && !selectedNote.title) {
					const note = notes.find(n => n.id === selectedNote.id);
					this.store.set({ note });
				}
			});
		},


	}
};

</script>
